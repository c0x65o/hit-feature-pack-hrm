name: hrm
title: Human Resources
description: HRM feature pack (employee directory + future payroll/benefits/performance)

# ─────────────────────────────────────────────────────────────────────────────
# SCHEMA - Drizzle ORM table definitions
# ─────────────────────────────────────────────────────────────────────────────
schema:
  source: src/schema/hrm.ts
  exports:
    - employees
    - Employee
    - InsertEmployee
    - UpdateEmployee

# ─────────────────────────────────────────────────────────────────────────────
# API ROUTES
# ─────────────────────────────────────────────────────────────────────────────
api:
  routes:
    - path: /api/hrm/employees/me
      methods: [GET, PUT]
      handler: "@hit/feature-pack-hrm/server/api/employees-me"
      description: "Get or upsert the current user's employee profile (name basics)."

    - path: /api/hrm/directory/users
      methods: [GET]
      handler: "@hit/feature-pack-hrm/server/api/directory-users"
      description: "User directory with display names enriched from HRM employees (fallbacks to auth profile_fields/email)."

    - path: /api/hrm/employees
      methods: [GET]
      handler: "@hit/feature-pack-hrm/server/api/employees"
      description: "Admin: list employees (employees are auto-provisioned from auth users)"

    - path: /api/hrm/employees/[id]
      methods: [GET, PUT]
      handler: "@hit/feature-pack-hrm/server/api/employees-id"
      description: "Admin: get/update an employee by id"

    - path: /api/hrm/employees/[id]/direct-reports
      methods: [GET]
      handler: "@hit/feature-pack-hrm/server/api/employees-direct-reports"
      description: "Get direct reports and org tree for an employee"

    - path: /api/hrm/employees/org-tree
      methods: [GET]
      handler: "@hit/feature-pack-hrm/server/api/employees-org-tree"
      description: "Get the org tree for all employees in scope"

    - path: /api/hrm/employees/[id]/photo
      methods: [PUT]
      handler: "@hit/feature-pack-hrm/server/api/employees-photo"
      description: "Update employee profile photo (self or admin)"

# Routes (pre-1.0: start Employees UI)
routes:
  - path: /hrm/employees
    page: EntityList
    params: { entityKey: hrm.employee }
  - path: /hrm/org-chart
    page: OrgChart
    roles: []
    default_roles_allow: [admin]
    authz: { entity: employees, verb: read, require_action: hrm.org-chart.access, show_pages: true }
  - path: /hrm/employees/[id]
    page: EntityDetail
    params: { entityKey: hrm.employee }
  - path: /hrm/employees/[id]/edit
    page: EntityEdit
    params: { entityKey: hrm.employee }

nav:
  - id: hrm
    label: HRM
    icon: Users
    group: main
    weight: 50
    showWhen: authenticated
    children:
      - id: hrm-employees
        label: Employees
        path: /hrm/employees
        icon: IdCard
        weight: 10
        showWhen: authenticated
      - id: hrm-org-chart
        label: Org Chart
        path: /hrm/org-chart
        icon: Share2
        weight: 20
        showWhen: authenticated
