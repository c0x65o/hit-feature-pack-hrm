name: hrm
title: Human Resources
description: HRM feature pack (employee directory + future payroll/benefits/performance)

# ─────────────────────────────────────────────────────────────────────────────
# SCHEMA - Drizzle ORM table definitions
# ─────────────────────────────────────────────────────────────────────────────
schema:
  source: src/schema/hrm.ts
  exports:
    - employees
    - Employee
    - InsertEmployee
    - UpdateEmployee

# ─────────────────────────────────────────────────────────────────────────────
# API ROUTES
# ─────────────────────────────────────────────────────────────────────────────
api:
  routes:
    - path: /api/hrm/employees/me
      methods: [GET, PUT]
      handler: "@hit/feature-pack-hrm/server/api/employees-me"
      description: "Get or upsert the current user's employee profile (name basics)."

    - path: /api/hrm/directory/users
      methods: [GET]
      handler: "@hit/feature-pack-hrm/server/api/directory-users"
      description: "User directory with display names enriched from HRM employees (fallbacks to auth profile_fields/email)."

    - path: /api/hrm/employees
      methods: [GET]
      handler: "@hit/feature-pack-hrm/server/api/employees"
      description: "Admin: list employees (employees are auto-provisioned from auth users)"

    - path: /api/hrm/employees/[id]
      methods: [GET, PUT]
      handler: "@hit/feature-pack-hrm/server/api/employees-id"
      description: "Admin: get/update an employee by id"

    - path: /api/hrm/employees/[id]/direct-reports
      methods: [GET]
      handler: "@hit/feature-pack-hrm/server/api/employees-direct-reports"
      description: "Get direct reports and org tree for an employee"

    - path: /api/hrm/employees/org-tree
      methods: [GET]
      handler: "@hit/feature-pack-hrm/server/api/employees-org-tree"
      description: "Get the org tree for all employees in scope"

    - path: /api/hrm/employees/[id]/photo
      methods: [PUT]
      handler: "@hit/feature-pack-hrm/server/api/employees-photo"
      description: "Update employee profile photo (self or admin)"

# Routes (pre-1.0: start Employees UI)
routes:
  - path: /hrm/employees
    page: EntityList
    roles: []
    default_roles_allow: [admin]
    authz: { entity: employees, verb: read, require_action: hrm.employees.access, show_pages: true }
    params: { entityKey: hrm.employee }
  - path: /hrm/org-chart
    page: OrgChart
    roles: []
    default_roles_allow: [admin]
    authz: { entity: employees, verb: read, require_action: hrm.org-chart.access, show_pages: true }
  - path: /hrm/employees/[id]
    page: EntityDetail
    roles: []
    default_roles_allow: [admin]
    authz: { entity: employees, verb: read, require_action: hrm.employees.detail.access, show_pages: true }
    params: { entityKey: hrm.employee }
  - path: /hrm/employees/[id]/edit
    page: EntityEdit
    roles: []
    default_roles_allow: [admin]
    authz: { entity: employees, verb: write, require_action: hrm.employees.edit.access, show_pages: true }
    params: { entityKey: hrm.employee }

nav:
  - id: hrm
    label: HRM
    icon: Users
    group: main
    weight: 50
    showWhen: authenticated
    children:
      - id: hrm-employees
        label: Employees
        path: /hrm/employees
        icon: IdCard
        weight: 10
        showWhen: authenticated
      - id: hrm-org-chart
        label: Org Chart
        path: /hrm/org-chart
        icon: Share2
        weight: 20
        showWhen: authenticated

# ─────────────────────────────────────────────────────────────────────────────
# PERMISSIONS - Action definitions (for admin-core permissions UI + runtime checks)
# ─────────────────────────────────────────────────────────────────────────────
permissions:
  actions:
    # HRM pages with explicit access toggles.
    - key: hrm.employees.access
      label: "HRM: Employees"
      description: "Access the HRM employees list."
      default_enabled: false
    - key: hrm.employees.detail.access
      label: "HRM: Employee Detail"
      description: "Access HRM employee detail pages."
      default_enabled: false
    - key: hrm.employees.edit.access
      label: "HRM: Employee Edit"
      description: "Access HRM employee edit pages."
      default_enabled: false
    - key: hrm.org-chart.access
      label: "HRM: Org Chart"
      description: "Access the HRM org chart page."
      default_enabled: false

    # Scope Policy Tree: HRM (global) -> entity overrides.
    #
    # Scope modes:
    # - none: deny all access for this verb/entity (hide pages + block APIs)
    # - all: ignore scope (read everything)
    # - own: only owned records (employee.userEmail === current user email)
    # - location|department|division: records matching the user's org assignment(s) for that dimension (via org_user_assignments)
    #
    # These are mutually exclusive per node; the Security Groups UI renders them as dropdowns.
    - key: hrm.read.scope.none
      label: "HRM Read Scope = None"
      description: "Deny all HRM read access."
      default_enabled: false
    - key: hrm.read.scope.all
      label: "HRM Read Scope = All"
      description: "Read all HRM entities regardless of org scope."
      default_enabled: false
    - key: hrm.read.scope.own
      label: "HRM Read Scope = Own"
      description: "Read only HRM entities you own (your own employee record)."
      default_enabled: false
    - key: hrm.read.scope.location
      label: "HRM Read Scope = Location"
      description: "Read HRM entities in your location."
      default_enabled: false
    - key: hrm.read.scope.department
      label: "HRM Read Scope = Department"
      description: "Read HRM entities in your department."
      default_enabled: false
    - key: hrm.read.scope.division
      label: "HRM Read Scope = Division"
      description: "Read HRM entities in your division."
      default_enabled: false

    - key: hrm.write.scope.none
      label: "HRM Write Scope = None"
      description: "Deny all HRM write access."
      default_enabled: false
    - key: hrm.write.scope.all
      label: "HRM Write Scope = All"
      description: "Edit all HRM entities regardless of org scope."
      default_enabled: false
    - key: hrm.write.scope.own
      label: "HRM Write Scope = Own"
      description: "Edit only HRM entities you own (your own employee record)."
      default_enabled: false
    - key: hrm.write.scope.location
      label: "HRM Write Scope = Location"
      description: "Edit HRM entities in your location."
      default_enabled: false
    - key: hrm.write.scope.department
      label: "HRM Write Scope = Department"
      description: "Edit HRM entities in your department."
      default_enabled: false
    - key: hrm.write.scope.division
      label: "HRM Write Scope = Division"
      description: "Edit HRM entities in your division."
      default_enabled: false

    # Employees override (optional): if set, overrides hrm.read.scope.* for employees only.
    - key: hrm.employees.read.scope.none
      label: "HRM Employees Read Scope = None"
      description: "Deny all employee read access."
      default_enabled: false
    - key: hrm.employees.read.scope.all
      label: "HRM Employees Read Scope = All"
      description: "Read employees regardless of org scope."
      default_enabled: false
    - key: hrm.employees.read.scope.own
      label: "HRM Employees Read Scope = Own"
      description: "Read only your own employee record."
      default_enabled: false
    - key: hrm.employees.read.scope.location
      label: "HRM Employees Read Scope = Location"
      description: "Read employees in your location."
      default_enabled: false
    - key: hrm.employees.read.scope.department
      label: "HRM Employees Read Scope = Department"
      description: "Read employees in your department."
      default_enabled: false
    - key: hrm.employees.read.scope.division
      label: "HRM Employees Read Scope = Division"
      description: "Read employees in your division."
      default_enabled: false

    - key: hrm.employees.write.scope.none
      label: "HRM Employees Write Scope = None"
      description: "Deny all employee write access."
      default_enabled: false
    - key: hrm.employees.write.scope.all
      label: "HRM Employees Write Scope = All"
      description: "Edit employees regardless of org scope."
      default_enabled: false
    - key: hrm.employees.write.scope.own
      label: "HRM Employees Write Scope = Own"
      description: "Edit only your own employee record."
      default_enabled: false
    - key: hrm.employees.write.scope.location
      label: "HRM Employees Write Scope = Location"
      description: "Edit employees in your location."
      default_enabled: false
    - key: hrm.employees.write.scope.department
      label: "HRM Employees Write Scope = Department"
      description: "Edit employees in your department."
      default_enabled: false
    - key: hrm.employees.write.scope.division
      label: "HRM Employees Write Scope = Division"
      description: "Edit employees in your division."
      default_enabled: false

    - key: hrm.employees.create
      label: Create Employee
      description: "Create a new employee (employees are auto-provisioned, but this action controls access to creation flows)."
      default_enabled: false
