name: hrm
title: Human Resources
description: HRM feature pack (employee directory + future payroll/benefits/performance)

# ─────────────────────────────────────────────────────────────────────────────
# SCHEMA - Drizzle ORM table definitions
# ─────────────────────────────────────────────────────────────────────────────
schema:
  source: src/schema/hrm.ts
  exports:
    - positions
    - Position
    - InsertPosition
    - UpdatePosition
    - employees
    - Employee
    - InsertEmployee
    - UpdateEmployee
    - holidays
    - Holiday
    - InsertHoliday
    - UpdateHoliday
    - leaveTypes
    - LeaveType
    - InsertLeaveType
    - UpdateLeaveType
    - ptoPolicies
    - PtoPolicy
    - InsertPtoPolicy
    - UpdatePtoPolicy
    - ptoPolicyAssignments
    - PtoPolicyAssignment
    - InsertPtoPolicyAssignment
    - UpdatePtoPolicyAssignment
    - ptoRequests
    - PtoRequest
    - InsertPtoRequest
    - UpdatePtoRequest
    - ptoBalances
    - PtoBalance
    - InsertPtoBalance
    - UpdatePtoBalance
    - ptoLedgerEntries
    - PtoLedgerEntry
    - InsertPtoLedgerEntry
    - UpdatePtoLedgerEntry

# ─────────────────────────────────────────────────────────────────────────────
# API ROUTES
# ─────────────────────────────────────────────────────────────────────────────
# NOTE: CRUD endpoints for schema entities are generated from `schema/entities/* api.resource`
# via the platform schema CRUD handler. Only "special" endpoints should be declared here.
api:
  routes:
    - path: /api/hrm/employees/me
      methods: [GET, PUT]
      handler: "@hit/feature-pack-hrm/server/api/employees-me"
      description: "Get or upsert the current user's employee profile (name basics)."

    - path: /api/hrm/employees
      methods: [GET, POST]
      handler: "@hit/feature-pack-hrm/server/api/employees"
      description: "Employees list + auto-provisioning (custom handler)."

    - path: /api/hrm/employees/[id]
      methods: [GET, PUT, DELETE]
      handler: "@hit/feature-pack-hrm/server/api/employees-id"
      description: "Employee detail/update (custom handler)."

    - path: /api/hrm/employees/sync
      methods: [POST]
      handler: "@hit/feature-pack-hrm/server/api/employees-sync"
      description: "Manually sync HRM employees with auth users."

    - path: /api/hrm/directory/users
      methods: [GET]
      handler: "@hit/feature-pack-hrm/server/api/directory-users"
      description: "User directory with display names enriched from HRM employees."

    - path: /api/hrm/employees/[id]/direct-reports
      methods: [GET]
      handler: "@hit/feature-pack-hrm/server/api/employees-direct-reports"
      description: "Get direct reports and org tree for an employee"

    - path: /api/hrm/employees/[id]/org-scope
      methods: [GET, PUT]
      handler: "@hit/feature-pack-hrm/server/api/employees-org-scope"
      description: "Get or update the org scope for an employee (org assignments)."

    - path: /api/hrm/employees/org-tree
      methods: [GET]
      handler: "@hit/feature-pack-hrm/server/api/employees-org-tree"
      description: "Get the org tree for all employees in scope"

    - path: /api/hrm/employees/[id]/photo
      methods: [PUT]
      handler: "@hit/feature-pack-hrm/server/api/employees-photo"
      description: "Update employee profile photo (self or admin)"

    - path: /api/hrm/employees/picker
      methods: [GET]
      handler: "@hit/feature-pack-hrm/server/api/employees-picker"
      description: "Lightweight employee picker for autocomplete. Requires hrm.employees.picker permission."

    - path: /api/hrm/pto-requests-self
      methods: [GET, POST]
      handler: "@hit/feature-pack-hrm/server/api/pto-requests-self"
      description: "Self-service PTO requests for the current employee."
    - path: /api/hrm/pto-requests-self/[id]
      methods: [GET, PUT]
      handler: "@hit/feature-pack-hrm/server/api/pto-requests-self-id"
      description: "Self-service PTO request detail (current employee only)."

# Routes (schema-driven UI pages)
routes:
  # Organization Chart (list widget)
  - path: /hrm/org-chart
    page: EntityList
    params: { entityKey: hrm.orgChart }
  # Positions
  - path: /hrm/positions
    page: EntityList
    params: { entityKey: hrm.position }
  - path: /hrm/positions/new
    page: EntityEdit
    params: { entityKey: hrm.position }
  - path: /hrm/positions/[id]
    page: EntityDetail
    params: { entityKey: hrm.position }
  - path: /hrm/positions/[id]/edit
    page: EntityEdit
    params: { entityKey: hrm.position }
  # Employees
  - path: /hrm/employees
    page: EntityList
    params: { entityKey: hrm.employee }
  - path: /hrm/employees/[id]
    page: EntityDetail
    params: { entityKey: hrm.employee }
  - path: /hrm/employees/[id]/edit
    page: EntityEdit
    params: { entityKey: hrm.employee }
  # PTO Requests
  - path: /hrm/pto/requests
    page: EntityList
    params: { entityKey: hrm.ptoRequest }
  - path: /hrm/pto/requests/new
    page: EntityEdit
    params: { entityKey: hrm.ptoRequest }
  - path: /hrm/pto/requests/[id]
    page: EntityDetail
    params: { entityKey: hrm.ptoRequest }
  - path: /hrm/pto/requests/[id]/edit
    page: EntityEdit
    params: { entityKey: hrm.ptoRequest }
  # My PTO Requests (self-service)
  - path: /hub/pto
    page: EntityList
    params: { entityKey: hrm.ptoRequestSelf }
  - path: /hub/pto/new
    page: EntityEdit
    params: { entityKey: hrm.ptoRequestSelf }
  - path: /hub/pto/[id]
    page: EntityDetail
    params: { entityKey: hrm.ptoRequestSelf }
  # PTO Setup: Leave Types
  - path: /hrm/pto/leave-types
    page: EntityList
    params: { entityKey: hrm.leaveType }
  - path: /hrm/pto/leave-types/new
    page: EntityEdit
    params: { entityKey: hrm.leaveType }
  - path: /hrm/pto/leave-types/[id]
    page: EntityDetail
    params: { entityKey: hrm.leaveType }
  - path: /hrm/pto/leave-types/[id]/edit
    page: EntityEdit
    params: { entityKey: hrm.leaveType }
  # PTO Setup: Holidays
  - path: /hrm/pto/holidays
    page: EntityList
    params: { entityKey: hrm.holiday }
  - path: /hrm/pto/holidays/new
    page: EntityEdit
    params: { entityKey: hrm.holiday }
  - path: /hrm/pto/holidays/[id]
    page: EntityDetail
    params: { entityKey: hrm.holiday }
  - path: /hrm/pto/holidays/[id]/edit
    page: EntityEdit
    params: { entityKey: hrm.holiday }
  # PTO Setup: Policies
  - path: /hrm/pto/policies
    page: EntityList
    params: { entityKey: hrm.ptoPolicy }
  - path: /hrm/pto/policies/new
    page: EntityEdit
    params: { entityKey: hrm.ptoPolicy }
  - path: /hrm/pto/policies/[id]
    page: EntityDetail
    params: { entityKey: hrm.ptoPolicy }
  - path: /hrm/pto/policies/[id]/edit
    page: EntityEdit
    params: { entityKey: hrm.ptoPolicy }
  # PTO Setup: Assignments
  - path: /hrm/pto/assignments
    page: EntityList
    params: { entityKey: hrm.ptoPolicyAssignment }
  - path: /hrm/pto/assignments/new
    page: EntityEdit
    params: { entityKey: hrm.ptoPolicyAssignment }
  - path: /hrm/pto/assignments/[id]
    page: EntityDetail
    params: { entityKey: hrm.ptoPolicyAssignment }
  - path: /hrm/pto/assignments/[id]/edit
    page: EntityEdit
    params: { entityKey: hrm.ptoPolicyAssignment }
  # PTO Balances
  - path: /hrm/pto/balances
    page: EntityList
    params: { entityKey: hrm.ptoBalance }
  - path: /hrm/pto/balances/[id]
    page: EntityDetail
    params: { entityKey: hrm.ptoBalance }
  # PTO Ledger
  - path: /hrm/pto/ledger
    page: EntityList
    params: { entityKey: hrm.ptoLedgerEntry }
  - path: /hrm/pto/ledger/[id]
    page: EntityDetail
    params: { entityKey: hrm.ptoLedgerEntry }

nav:
  - id: hrm
    label: HRM
    icon: Users
    group: main
    weight: 50
    showWhen: authenticated
    children:
      - id: hrm-employees
        label: Employees
        path: /hrm/employees
        icon: IdCard
        weight: 10
        showWhen: authenticated
      - id: hrm-org-chart
        label: Organization Chart
        path: /hrm/org-chart
        icon: Network
        weight: 20
        showWhen: authenticated
      - id: hrm-pto-requests
        label: PTO Requests
        path: /hrm/pto/requests
        icon: Calendar
        weight: 30
        showWhen: authenticated
      - id: hrm-setup
        label: Setup
        icon: Settings
        weight: 100
        showWhen: authenticated
        children:
          - id: hrm-positions
            label: Positions
            path: /hrm/positions
            icon: Briefcase
            weight: 10
            showWhen: authenticated
          - id: hrm-pto-setup
            label: PTO
            icon: Calendar
            weight: 20
            showWhen: authenticated
            children:
              - id: hrm-pto-leave-types
                label: Leave Types
                path: /hrm/pto/leave-types
                icon: Tag
                weight: 10
                showWhen: authenticated
              - id: hrm-pto-holidays
                label: Holidays
                path: /hrm/pto/holidays
                icon: CalendarDays
                weight: 15
                showWhen: authenticated
              - id: hrm-pto-policies
                label: PTO Policies
                path: /hrm/pto/policies
                icon: ClipboardList
                weight: 20
                showWhen: authenticated
              - id: hrm-pto-assignments
                label: PTO Assignments
                path: /hrm/pto/assignments
                icon: UsersRound
                weight: 30
                showWhen: authenticated
              - id: hrm-pto-balances
                label: PTO Balances
                path: /hrm/pto/balances
                icon: Scale
                weight: 40
                showWhen: authenticated
              - id: hrm-pto-ledger
                label: PTO Ledger
                path: /hrm/pto/ledger
                icon: FileSpreadsheet
                weight: 50
                showWhen: authenticated

requires:
  modules: [auth]

dependencies:
  feature_packs:
    - name: auth-core
