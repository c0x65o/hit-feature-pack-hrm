name: hrm
title: Human Resources
description: HRM feature pack (employee directory + future payroll/benefits/performance)

# ─────────────────────────────────────────────────────────────────────────────
# SCHEMA - Drizzle ORM table definitions
# ─────────────────────────────────────────────────────────────────────────────
schema:
  source: src/schema/hrm.ts
  exports:
    - positions
    - Position
    - InsertPosition
    - UpdatePosition
    - employees
    - Employee
    - InsertEmployee
    - UpdateEmployee

# ─────────────────────────────────────────────────────────────────────────────
# API ROUTES
# ─────────────────────────────────────────────────────────────────────────────
# NOTE: CRUD endpoints for schema entities are generated from `schema/entities/* api.resource`
# via the platform schema CRUD handler. Only "special" endpoints should be declared here.
api:
  routes:
    - path: /api/hrm/employees/me
      methods: [GET, PUT]
      handler: "@hit/feature-pack-hrm/server/api/employees-me"
      description: "Get or upsert the current user's employee profile (name basics)."

    - path: /api/hrm/employees/sync
      methods: [POST]
      handler: "@hit/feature-pack-hrm/server/api/employees-sync"
      description: "Manually sync HRM employees with auth users."

    - path: /api/hrm/directory/users
      methods: [GET]
      handler: "@hit/feature-pack-hrm/server/api/directory-users"
      description: "User directory with display names enriched from HRM employees."

    - path: /api/hrm/employees/[id]/direct-reports
      methods: [GET]
      handler: "@hit/feature-pack-hrm/server/api/employees-direct-reports"
      description: "Get direct reports and org tree for an employee"

    - path: /api/hrm/employees/[id]/org-scope
      methods: [GET, PUT]
      handler: "@hit/feature-pack-hrm/server/api/employees-org-scope"
      description: "Get or update the org scope for an employee (org assignments)."

    - path: /api/hrm/employees/org-tree
      methods: [GET]
      handler: "@hit/feature-pack-hrm/server/api/employees-org-tree"
      description: "Get the org tree for all employees in scope"

    - path: /api/hrm/employees/[id]/photo
      methods: [PUT]
      handler: "@hit/feature-pack-hrm/server/api/employees-photo"
      description: "Update employee profile photo (self or admin)"

    - path: /api/hrm/employees/picker
      methods: [GET]
      handler: "@hit/feature-pack-hrm/server/api/employees-picker"
      description: "Lightweight employee picker for autocomplete. Requires hrm.employees.picker permission."

# Routes (schema-driven UI pages)
routes:
  # Positions
  - path: /hrm/positions
    page: EntityList
    params: { entityKey: hrm.position }
  - path: /hrm/positions/new
    page: EntityEdit
    params: { entityKey: hrm.position }
  - path: /hrm/positions/[id]
    page: EntityDetail
    params: { entityKey: hrm.position }
  - path: /hrm/positions/[id]/edit
    page: EntityEdit
    params: { entityKey: hrm.position }
  # Employees
  - path: /hrm/employees
    page: EntityList
    params: { entityKey: hrm.employee }
  - path: /hrm/employees/[id]
    page: EntityDetail
    params: { entityKey: hrm.employee }
  - path: /hrm/employees/[id]/edit
    page: EntityEdit
    params: { entityKey: hrm.employee }

nav:
  - id: hrm
    label: HRM
    icon: Users
    group: main
    weight: 50
    showWhen: authenticated
    children:
      - id: hrm-employees
        label: Employees
        path: /hrm/employees
        icon: IdCard
        weight: 10
        showWhen: authenticated
      - id: hrm-setup
        label: Setup
        icon: Settings
        weight: 100
        showWhen: authenticated
        children:
          - id: hrm-positions
            label: Positions
            path: /hrm/positions
            icon: Briefcase
            weight: 10
            showWhen: authenticated

requires:
  modules: [auth]

dependencies:
  feature_packs:
    - name: auth-core
