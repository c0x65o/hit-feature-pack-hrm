version: 1

entities:
  hrm.ptoRequest:
    meta:
      titleSingular: PTO Request
      titlePlural: PTO Requests
      descriptionPlural: Employee PTO requests
      routes:
        root: /hrm/pto
        list: /hrm/pto/requests
        new: /hrm/pto/requests/new
        detail: /hrm/pto/requests/{id}
        edit: /hrm/pto/requests/{id}/edit
      breadcrumbs:
        - { label: HRM, href: /hrm }
        - { label: PTO, href: /hrm/pto/requests }
      actions:
        createLabel: New PTO Request
        editLabel: Edit PTO Request
        saveCreateLabel: Submit Request
        saveUpdateLabel: Save
        cancelLabel: Cancel
        deleteLabel: Delete
        deleteConfirmTitle: Delete PTO Request
        deleteConfirmBody: Are you sure you want to delete this PTO request? This action cannot be undone.

    security:
      list:
        roles: []
        default_roles_allow: [admin]
        authz: { entity: ptoRequests, verb: read, require_action: hrm.pto.requests.access, show_pages: true }
      detail:
        roles: []
        default_roles_allow: [admin]
        authz: { entity: ptoRequests, verb: read, require_action: hrm.pto.requests.access, show_pages: true }
      new:
        roles: []
        default_roles_allow: [admin]
        authz: { entity: ptoRequests, verb: write, require_action: hrm.pto.requests.manage, require_create: true, show_pages: true }
      edit:
        roles: []
        default_roles_allow: [admin]
        authz: { entity: ptoRequests, verb: write, require_action: hrm.pto.requests.manage, show_pages: true }
      delete:
        roles: []
        default_roles_allow: [admin]
        authz: { entity: ptoRequests, verb: write, require_action: hrm.pto.requests.manage, show_pages: true }

    api:
      baseUrl: /api/hrm/pto-requests

    storage:
      drizzleTable: ptoRequests

    list:
      tableId: hrm.ptoRequests
      uiStateVersion: 1
      pageSize: 25
      initialSort: { sortBy: createdAt, sortOrder: desc }
      sortWhitelist: [employeeId, status, startDate, endDate, createdAt]
      initialColumnVisibility:
        employeeId: true
        leaveTypeName: true
        status: true
        startDate: true
        endDate: true
        amount: true
        unit: true
        createdAt: false
      columns:
        - key: employeeId
          label: Employee
          reference:
            entityType: hrm.employee
            labelFromRow: employeeName
        - leaveTypeName
        - status
        - startDate
        - endDate
        - amount
        - unit
        - createdAt

    form:
      sections:
        - id: basics
          title: Request Details
          layout: { columns: 2 }
          fields: [employeeId, leaveTypeId, policyId, status, startDate, endDate, amount, unit]
        - id: notes
          title: Notes
          layout: { columns: 1 }
          fields: [reason, decisionNote]
        - id: audit
          title: Audit
          layout: { columns: 2 }
          fields: [requestedByUserKey, submittedAt, approvedAt, approvedByUserKey, deniedAt, deniedByUserKey, workflowRunId]

    fields:
      id: { type: text, label: ID }
      employeeId:
        type: reference
        label: Employee
        optionSource: hrm.employees
        labelFromRow: employeeName
        reference:
          entityType: hrm.employee
          pickerEndpoint: /api/hrm/employees/picker
          valueField: id
          labelField: displayName
        required: true
      employeeName:
        type: text
        label: Employee
        virtual: true
        compute:
          kind: labelFrom
          sourceField: employeeId
      leaveTypeId:
        type: select
        label: Leave Type
        optionSource: hrm.leaveTypes
        labelFromRow: leaveTypeName
        required: true
      leaveTypeName:
        type: text
        label: Leave Type
        virtual: true
        compute:
          kind: labelFrom
          sourceField: leaveTypeId
      policyId:
        type: select
        label: PTO Policy
        optionSource: hrm.ptoPolicies
        labelFromRow: policyName
      policyName:
        type: text
        label: Policy
        virtual: true
        compute:
          kind: labelFrom
          sourceField: policyId
      status:
        type: select
        label: Status
        options:
          - { value: draft, label: Draft }
          - { value: submitted, label: Submitted }
          - { value: approved, label: Approved }
          - { value: rejected, label: Rejected }
          - { value: cancelled, label: Cancelled }
      startDate: { type: date, label: Start Date, required: true }
      endDate: { type: date, label: End Date, required: true }
      amount: { type: number, label: Amount }
      unit:
        type: select
        label: Unit
        options:
          - { value: days, label: Days }
          - { value: hours, label: Hours }
      reason: { type: textarea, label: Reason }
      requestedByUserKey: { type: text, label: Requested By, readOnly: true }
      submittedAt: { type: datetime, label: Submitted At, readOnly: true }
      approvedAt: { type: datetime, label: Approved At, readOnly: true }
      approvedByUserKey: { type: text, label: Approved By, readOnly: true }
      deniedAt: { type: datetime, label: Denied At, readOnly: true }
      deniedByUserKey: { type: text, label: Denied By, readOnly: true }
      decisionNote: { type: textarea, label: Decision Note }
      workflowRunId: { type: text, label: Workflow Run ID, readOnly: true }
      createdAt: { type: datetime, label: Created }
      updatedAt: { type: datetime, label: Updated }

    detail:
      summaryTitle: PTO Request Details
      summaryFields:
        - employeeId
        - leaveTypeName
        - policyName
        - status
        - startDate
        - endDate
        - amount
        - unit
        - reason
        - decisionNote
        - requestedByUserKey
        - submittedAt
        - approvedAt
        - approvedByUserKey
        - deniedAt
        - deniedByUserKey
        - workflowRunId
        - createdAt
        - updatedAt
